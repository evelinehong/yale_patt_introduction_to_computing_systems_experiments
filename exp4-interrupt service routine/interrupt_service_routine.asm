	.ORIG x2000
	ADD R6,R6,#-1	;Store the data at a stack
	STR R0,R6,#0
	ADD R6,R6,#-1
	STR R1,R6,#0
	ADD R6,R6,#-1
	STR R2,R6,#0
	ADD R6,R6,#-1
	STR R3,R6,#0
	ADD R5,R5,#1
LOOP	ST R0,SaveR0
STAR	LDI R1,KBSR
	BRzp STAR
	LDI R0,KBDR
	LD R2,NEWLINE
	ADD R2,R2,R0
	BRnp LOOP

	AND R3,R3,#0
	ADD R3,R3,#10
AGAIN	LD R0,SaveR0
START	LDI R1,DSR
	BRzp START
	STI R0,DDR
	ADD R3,R3,#-1
	BRp AGAIN
	LD R0,LINE
START2	LDI R1,DSR
	BRzp START2
	STI R0,DDR

	LDR R3,R6,#0
	ADD R6,R6,#1
	LDR R2,R6,#0
	ADD R6,R6,#1
	LDR R1,R6,#0
	ADD R6,R6,#1
	LDR R0,R6,#0
	ADD R6,R6,#1
	RTI

KBSR	.FILL XFE00
KBDR	.FILL XFE02
DSR	.FILL XFE04
DDR	.FILL XFE06
FIRST	.FILL X4000
NEWLINE .FILL XFFF6
LINE	.FILL X000A
SaveR0	.FILL 0
	.END